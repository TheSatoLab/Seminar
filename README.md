# 次期流行株ドライ解析テストデータ（セミナー用）

### ⚫︎目的  
   多項ロジスティックモデルを用いて新型コロナウイルスの変異株の実効再生産数（Re）を推定し、Reの高い次期流行株を検出する

### ⚫︎このGitHubに含まれるデータ
1. multinomial_independent.ver2.stan
- 多項ロジスティックモデルが書かれたStanスクリプト
2. metadata_filtered_USA_230701_231130.txt.zip
- メインのメタデータファイル
- 今回は2023年7月1日-2023年11月30日（150日間）、米国で新型コロナウイルスに感染した人から検出されたメタデータを使用する（[Nextstrain](https://nextstrain.org/ncov/open/global/6m?lang=ja)から全メタデータをダウンロードし、講義用にフィルタリング）
3. script[^1] （講義では使用しない）
- 解析に使用するRスクリプト、2.のメタデータ作成に使用したRスクリプト、国名リスト（講義ではGoogleColabを使用する）

### ⚫︎講義で使用するRスクリプト  
 Rスクリプト（今回はGoogle Colaboratoryを使用[^2]）：  
https://colab.research.google.com/drive/1-4ZP70zQTcQBAJeahSJ7V1GS7akta5BA?usp=sharing

### ⚫︎手順

Step 1 必要なパッケージをインストール
- デフォルトで備わっているパッケージ以外はその都度インストールする必要がある
- 今回の場合は、rbin, cmdstanr, patchwork

Step 2 Step 1でインストールしたパッケージ及び、使用したいパッケージを読み込み起動する

Step 3 cmdstanをインストールする（少し時間がかかる）
- Stanのスクリプトを実装するソフトウェア
  
Step 4 GitHubからファイルを取ってくる
- GitHubのリンクを使って、GoogleColabと連携させる
- ただしメタデータファイルはzipで圧縮されているのでStep 5で解凍する

Step 5 解析に使う変数とパラメータを設定する
- cmdstanのパス名を設定→Step 3で表示されたcmdstanのインストール先合わせて変更
- 改めてStanファイルの変数名を設定＆メタデータを解凍し変数名を設定
- アウトプットする際の名前を設定（GoogleColab上で結果を可視化する場合はいらない）
- 他、解析のコア数、基準となる変数、インプットの解析期間、最小配列数などを設定
- Stanファイルをコンパイルする

Step 6 インプットデータの加工
- メタデータを解析で使用するためにフィルタリング等で加工する

Step 7 実効再生産数の解析（かなり時間がかかる）
- インプットデータを多項ロジスティックモデルに当てはめて実効再生産数を推定

Step 8 ビジュアライズ①実効再生産数

Step 9 ビジュアライズ②流行動態

Step 10 解析結果をpdfなどにアウトプットする（ここもGoogleColab上で結果を可視化する場合はいらない）

> [!NOTE]
> GoogleColab上アウトプットしたファイルをローカルPCにダウンロードする方法：  
> GoogleColabの画面左側のファイルアイコンをクリック - アウトプットしたファイルを右クリック - 「ダウンロード」


[^1]: 詳細はフォルダ内をご参照ください
[^2]: Googleアカウントにサインインしてご使用ください

